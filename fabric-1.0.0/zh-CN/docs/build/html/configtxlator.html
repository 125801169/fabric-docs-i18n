

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Reconfiguring with configtxlator &mdash; hyperledger-fabricdocs master documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Endorsement policies" href="endorsement-policies.html" />
    <link rel="prev" title="Channel Configuration (configtxgen)" href="configtxgen.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          


          
            <a href="index.html" class="icon icon-home"> hyperledger-fabricdocs
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
<br>
<a href="https://chat.hyperledger.org">Rocket Chat</a>  <a href="https://jenkins.hyperledger.org/">CI</a>
<a href="http://stackoverflow.com/questions/tagged/hyperledger-fabric">StackOverflow</a>
<br>
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>
  <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="prereqs.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="samples.html">Hyperledger Fabric Samples</a></li>
</ul>
<p class="caption"><span class="caption-text">Key Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="blockchain.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="capabilities.html">Hyperledger Fabric Capabilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="fabric_model.html">Hyperledger Fabric Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="usecases.html">Use Cases</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="build_network.html">Building Your First Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="write_first_app.html">Writing Your First Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="chaincode.html">Chaincode Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="chaincode4ade.html">Chaincode for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="chaincode4noah.html">Chaincode for Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="videos.html">Videos</a></li>
</ul>
<p class="caption"><span class="caption-text">Operations Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="msp.html">Membership Service Providers (MSP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="configtx.html">Channel Configuration (configtx)</a></li>
<li class="toctree-l1"><a class="reference internal" href="configtxgen.html">Channel Configuration (configtxgen)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Reconfiguring with configtxlator</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-configtxlator">Running the configtxlator</a></li>
<li class="toctree-l2"><a class="reference internal" href="#proto-translation">Proto translation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#config-update-computation">Config update computation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bootstraping-example">Bootstraping example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reconfiguration-example">Reconfiguration example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-an-organization">Adding an organization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="endorsement-policies.html">Endorsement policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="error-handling.html">Error handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging-control.html">Logging Control</a></li>
</ul>
<p class="caption"><span class="caption-text">Architecture</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="arch-deep-dive.html">Architecture Explained</a></li>
<li class="toctree-l1"><a class="reference internal" href="txflow.html">Transaction Flow</a></li>
<li class="toctree-l1"><a class="reference external" href="http://hyperledger-fabric-ca.readthedocs.io/en/latest">Hyperledger Fabric CA's User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="fabric-sdks.html">Hyperledger Fabric SDKs</a></li>
<li class="toctree-l1"><a class="reference internal" href="kafka.html">Bringing up a Kafka-based Ordering Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="channels.html">Channels</a></li>
<li class="toctree-l1"><a class="reference internal" href="ledger.html">Ledger</a></li>
<li class="toctree-l1"><a class="reference internal" href="readwrite.html">Read-Write set semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="gossip.html">Gossip data dissemination protocol</a></li>
</ul>
<p class="caption"><span class="caption-text">Troubleshooting and FAQs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Fabric-FAQ.html">Hyperledger Fabric FAQ</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributions Welcome!</a></li>
<li class="toctree-l1"><a class="reference internal" href="MAINTAINERS.html">Maintainers</a></li>
<li class="toctree-l1"><a class="reference internal" href="jira_navigation.html">Using Jira to understand current work items</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-setup/devenv.html">Setting up the development environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-setup/build.html">Building Hyperledger Fabric</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-setup/build.html#building-outside-of-vagrant">Building outside of Vagrant</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-setup/build.html#configuration">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-setup/build.html#logging">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="Gerrit/lf-account.html">Requesting a Linux Foundation Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="Gerrit/gerrit.html">Working with Gerrit</a></li>
<li class="toctree-l1"><a class="reference internal" href="Gerrit/changes.html">Submitting a Change to Gerrit</a></li>
<li class="toctree-l1"><a class="reference internal" href="Gerrit/reviewing.html">Reviewing a Change</a></li>
<li class="toctree-l1"><a class="reference internal" href="Gerrit/best-practices.html">Gerrit Recommended Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Style-guides/go-style.html">Coding guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="Style-guides/go-style.html#generating-grpc-code">Generating gRPC code</a></li>
<li class="toctree-l1"><a class="reference internal" href="Style-guides/go-style.html#adding-or-updating-go-packages">Adding or updating Go packages</a></li>
</ul>
<p class="caption"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="questions.html">Still Have Questions?</a></li>
<li class="toctree-l1"><a class="reference internal" href="status.html">Status</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">hyperledger-fabricdocs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Reconfiguring with configtxlator</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/configtxlator.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="reconfiguring-with-configtxlator">
<h1>Reconfiguring with configtxlator<a class="headerlink" href="#reconfiguring-with-configtxlator" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">configtxlator</span></code> tool was created to support reconfiguration independent
of SDKs. Channel configuration is stored as a transaction in configuration
blocks of a channel and may be manipulated directly, such as in the bdd behave
tests.  However, at the time of this writing, no SDK natively supports
manipulating the configuration directly, so the <code class="docutils literal notranslate"><span class="pre">configtxlator</span></code> tool is
designed to provide an API which consumers of any SDK may interact with to
assist with configuration updates.</p>
<p>The tool name is a portmanteau of <em>configtx</em> and <em>translator</em> and is intended to
convey that the tool simply converts between different equivalent data
representations. It does not generate configuration. It does not submit or
retrieve configuration. It does not modify configuration itself, it simply
provides some bijective operations between different views of the configtx
format.</p>
<p>The standard usage is expected to be:</p>
<blockquote>
<div><ol class="arabic simple">
<li>SDK retrieves latest config</li>
<li><code class="docutils literal notranslate"><span class="pre">configtxlator</span></code> produces human readable version of config</li>
<li>User or application edits the config</li>
<li><code class="docutils literal notranslate"><span class="pre">configtxlator</span></code> is used to compute config update representation of
changes to the config</li>
<li>SDK submits signs and submits config</li>
</ol>
</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">configtxlator</span></code> tool exposes a truly stateless REST API for interacting
with configuration elements.  These REST components support converting the
native configuration format to/from a human readable JSON representation, as
well as computing configuration updates based on the difference between two
configurations.</p>
<p>Because the <code class="docutils literal notranslate"><span class="pre">configtxlator</span></code> service deliberately does not contain any crypto
material, or otherwise secret information, it does not include any authorization
or access control. The anticipated typical deployment would be to operate as
a sandboxed container, locally with the application, so that there is a
dedicated <code class="docutils literal notranslate"><span class="pre">configtxlator</span></code> process for each consumer of it.</p>
</div>
<div class="section" id="running-the-configtxlator">
<h2>Running the configtxlator<a class="headerlink" href="#running-the-configtxlator" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">configtxlator</span></code> tool can be downloaded with the other Hyperledger Fabric
platform-specific binaries. Please see <span class="xref std std-ref">download-platform-specific-binaries</span>
for details.</p>
<p>The tool may be configured to listen on a different port and you may also
specify the hostname using the <code class="docutils literal notranslate"><span class="pre">--port</span></code> and <code class="docutils literal notranslate"><span class="pre">--hostname</span></code> flags. To explore
the complete set of commands and flags, run <code class="docutils literal notranslate"><span class="pre">configtxlator</span> <span class="pre">--help</span></code>.</p>
<p>The binary will start an http server listening on the designated port and is now
ready to process request.</p>
<p>To start the <code class="docutils literal notranslate"><span class="pre">configtxlator</span></code> server:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">configtxlator</span> <span class="n">start</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">21</span> <span class="mi">18</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mf">58.248</span> <span class="n">HKT</span> <span class="p">[</span><span class="n">configtxlator</span><span class="p">]</span> <span class="n">startServer</span> <span class="o">-&gt;</span> <span class="n">INFO</span> <span class="mi">001</span> <span class="n">Serving</span> <span class="n">HTTP</span> <span class="n">requests</span> <span class="n">on</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">7059</span>
</pre></div>
</div>
</div>
<div class="section" id="proto-translation">
<h2>Proto translation<a class="headerlink" href="#proto-translation" title="Permalink to this headline">¶</a></h2>
<p>For extensibility, and because certain fields must be signed over, many proto
fields are stored as bytes.  This makes the natural proto to JSON translation
using the <code class="docutils literal notranslate"><span class="pre">jsonpb</span></code> package ineffective for producing a human readable version
of the protobufs.  Instead, the <code class="docutils literal notranslate"><span class="pre">configtxlator</span></code> exposes a REST component to do
a more sophisticated translation.</p>
<p>To convert a proto to its human readable JSON equivalent, simply post the binary
proto to the rest target
<code class="docutils literal notranslate"><span class="pre">http://$SERVER:$PORT/protolator/decode/&lt;message.Name&gt;</span></code>,
where <code class="docutils literal notranslate"><span class="pre">&lt;message.Name&gt;</span></code> is the fully qualified proto name of the message.</p>
<p>For instance, to decode a configuration block saved as
<code class="docutils literal notranslate"><span class="pre">configuration_block.pb</span></code>, run the command:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">binary</span> <span class="nd">@configuration_block</span><span class="o">.</span><span class="n">pb</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">7059</span><span class="o">/</span><span class="n">protolator</span><span class="o">/</span><span class="n">decode</span><span class="o">/</span><span class="n">common</span><span class="o">.</span><span class="n">Block</span>
</pre></div>
</div>
<p>To convert the human readable JSON version of the proto message, simply post the
JSON version to <code class="docutils literal notranslate"><span class="pre">http://$SERVER:$PORT/protolator/encode/&lt;message.Name</span></code>, where
<code class="docutils literal notranslate"><span class="pre">&lt;message.Name&gt;</span></code> is again the fully qualified proto name of the message.</p>
<p>For instance, to re-encode the block saved as <code class="docutils literal notranslate"><span class="pre">configuration_block.json</span></code>, run
the command:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">binary</span> <span class="nd">@configuration_block</span><span class="o">.</span><span class="n">json</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">7059</span><span class="o">/</span><span class="n">protolator</span><span class="o">/</span><span class="n">encode</span><span class="o">/</span><span class="n">common</span><span class="o">.</span><span class="n">Block</span>
</pre></div>
</div>
<p>Any of the configuration related protos, including <code class="docutils literal notranslate"><span class="pre">common.Block</span></code>,
<code class="docutils literal notranslate"><span class="pre">common.Envelope</span></code>, <code class="docutils literal notranslate"><span class="pre">common.ConfigEnvelope</span></code>, <code class="docutils literal notranslate"><span class="pre">common.ConfigUpdateEnvelope</span></code>,
<code class="docutils literal notranslate"><span class="pre">common.Configuration</span></code>, and <code class="docutils literal notranslate"><span class="pre">common.ConfigUpdate</span></code> are valid targets for
these URLs.  In the future, other proto decoding types may be added, such as
for endorser transactions.</p>
</div>
<div class="section" id="config-update-computation">
<h2>Config update computation<a class="headerlink" href="#config-update-computation" title="Permalink to this headline">¶</a></h2>
<p>Given two different configurations, it is possible to compute the config update
which transitions between them.  Simply POST the two <code class="docutils literal notranslate"><span class="pre">common.Config</span></code> proto
encoded configurations as <code class="docutils literal notranslate"><span class="pre">multipart/formdata</span></code>, with the original as field
<code class="docutils literal notranslate"><span class="pre">original</span></code> and the updated as field <code class="docutils literal notranslate"><span class="pre">updated</span></code>, to
<code class="docutils literal notranslate"><span class="pre">http://$SERVER:$PORT/configtxlator/compute/update-from-configs</span></code>.</p>
<p>For example, given the original config as the file <code class="docutils literal notranslate"><span class="pre">original_config.pb</span></code> and
the updated config as the file <code class="docutils literal notranslate"><span class="pre">updated_config.pb</span></code> for the channel
<code class="docutils literal notranslate"><span class="pre">desiredchannel</span></code>:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">F</span> <span class="n">channel</span><span class="o">=</span><span class="n">desiredchannel</span> <span class="o">-</span><span class="n">F</span> <span class="n">original</span><span class="o">=</span><span class="nd">@original_config</span><span class="o">.</span><span class="n">pb</span> <span class="o">-</span><span class="n">F</span> <span class="n">updated</span><span class="o">=</span><span class="nd">@updated_config</span><span class="o">.</span><span class="n">pb</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">7059</span><span class="o">/</span><span class="n">configtxlator</span><span class="o">/</span><span class="n">compute</span><span class="o">/</span><span class="n">update</span><span class="o">-</span><span class="n">from</span><span class="o">-</span><span class="n">configs</span>
</pre></div>
</div>
</div>
<div class="section" id="bootstraping-example">
<h2>Bootstraping example<a class="headerlink" href="#bootstraping-example" title="Permalink to this headline">¶</a></h2>
<p>First start the <code class="docutils literal notranslate"><span class="pre">configtxlator</span></code>:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>$ configtxlator start
2017-05-31 12:57:22.499 EDT [configtxlator] main -&gt; INFO 001 Serving HTTP requests on port: 7059
</pre></div>
</div>
<p>First, produce a genesis block for the ordering system channel:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>$ configtxgen -outputBlock genesis_block.pb
2017-05-31 14:15:16.634 EDT [common/configtx/tool] main -&gt; INFO 001 Loading configuration
2017-05-31 14:15:16.646 EDT [common/configtx/tool] doOutputBlock -&gt; INFO 002 Generating genesis block
2017-05-31 14:15:16.646 EDT [common/configtx/tool] doOutputBlock -&gt; INFO 003 Writing genesis block
</pre></div>
</div>
<p>Decode the genesis block into a human editable form:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">binary</span> <span class="nd">@genesis_block</span><span class="o">.</span><span class="n">pb</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">7059</span><span class="o">/</span><span class="n">protolator</span><span class="o">/</span><span class="n">decode</span><span class="o">/</span><span class="n">common</span><span class="o">.</span><span class="n">Block</span> <span class="o">&gt;</span> <span class="n">genesis_block</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Edit the <code class="docutils literal notranslate"><span class="pre">genesis_block.json</span></code> file in your favorite JSON editor, or manipulate
it programatically.  Here we use the JSON CLI tool <code class="docutils literal notranslate"><span class="pre">jq</span></code>.  For simplicity, we
are editing the batch size for the channel, because it is a single numeric
field. However, any edits, including policy and MSP edits may be made here.</p>
<p>First, let’s establish an environment variable to hold the string that defines
the path to a property in the json:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">MAXBATCHSIZEPATH</span><span class="o">=</span><span class="s2">&quot;.data.data[0].payload.data.config.channel_group.groups.Orderer.values.BatchSize.value.max_message_count&quot;</span>
</pre></div>
</div>
<p>Next, let’s display the value of that property:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jq</span> <span class="s2">&quot;$MAXBATCHSIZEPATH&quot;</span> <span class="n">genesis_block</span><span class="o">.</span><span class="n">json</span>
<span class="mi">10</span>
</pre></div>
</div>
<p>Now, let’s set the new batch size, and display the new value:</p>
<blockquote>
<div>jq “$MAXBATCHSIZEPATH = 20” genesis_block.json  &gt; updated_genesis_block.json
jq “$MAXBATCHSIZEPATH” updated_genesis_block.json
20</div></blockquote>
<p>The genesis block is now ready to be re-encoded into the native proto form to be
used for bootstrapping:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">binary</span> <span class="nd">@updated_genesis_block</span><span class="o">.</span><span class="n">json</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">7059</span><span class="o">/</span><span class="n">protolator</span><span class="o">/</span><span class="n">encode</span><span class="o">/</span><span class="n">common</span><span class="o">.</span><span class="n">Block</span> <span class="o">&gt;</span> <span class="n">updated_genesis_block</span><span class="o">.</span><span class="n">pb</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">updated_genesis_block.pb</span></code> file may now be used as the genesis block for
bootstrapping an ordering system channel.</p>
</div>
<div class="section" id="reconfiguration-example">
<h2>Reconfiguration example<a class="headerlink" href="#reconfiguration-example" title="Permalink to this headline">¶</a></h2>
<p>In another terminal window, start the orderer using the default options,
including the provisional bootstrapper which will create a <code class="docutils literal notranslate"><span class="pre">testchainid</span></code>
ordering system channel.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ORDERER_GENERAL_LOGLEVEL</span><span class="o">=</span><span class="n">debug</span> <span class="n">orderer</span>
</pre></div>
</div>
<p>Reconfiguring a channel can be performed in a very similar way to modifying a
genesis config.</p>
<p>First, fetch the config_block proto:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>$ peer channel fetch config config_block.pb -o 127.0.0.1:7050 -c testchainid
2017-05-31 15:11:37.617 EDT [msp] getMspConfig -&gt; INFO 001 intermediate certs folder not found at [/home/yellickj/go/src/github.com/hyperledger/fabric/sampleconfig/msp/intermediatecerts]. Skipping.: [stat /home/yellickj/go/src/github.com/hyperledger/fabric/sampleconfig/msp/intermediatecerts: no such file or directory]
2017-05-31 15:11:37.617 EDT [msp] getMspConfig -&gt; INFO 002 crls folder not found at [/home/yellickj/go/src/github.com/hyperledger/fabric/sampleconfig/msp/intermediatecerts]. Skipping.: [stat /home/yellickj/go/src/github.com/hyperledger/fabric/sampleconfig/msp/crls: no such file or directory]
Received block:  1
Received block:  1
2017-05-31 15:11:37.635 EDT [main] main -&gt; INFO 003 Exiting.....
</pre></div>
</div>
<p>Next, send the config block to the <code class="docutils literal notranslate"><span class="pre">configtxlator</span></code> service for decoding:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">binary</span> <span class="nd">@config_block</span><span class="o">.</span><span class="n">pb</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">7059</span><span class="o">/</span><span class="n">protolator</span><span class="o">/</span><span class="n">decode</span><span class="o">/</span><span class="n">common</span><span class="o">.</span><span class="n">Block</span> <span class="o">&gt;</span> <span class="n">config_block</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Extract the config section from the block:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jq</span> <span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">config</span> <span class="n">config_block</span><span class="o">.</span><span class="n">json</span> <span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Edit the config, saving it as a new <code class="docutils literal notranslate"><span class="pre">updated_config.json</span></code>.  Here, we set the
batch size to 30.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jq</span> <span class="s2">&quot;.channel_group.groups.Orderer.values.BatchSize.value.max_message_count = 30&quot;</span> <span class="n">config</span><span class="o">.</span><span class="n">json</span>  <span class="o">&gt;</span> <span class="n">updated_config</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Re-encode both the original config, and the updated config into proto:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">binary</span> <span class="nd">@config</span><span class="o">.</span><span class="n">json</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">7059</span><span class="o">/</span><span class="n">protolator</span><span class="o">/</span><span class="n">encode</span><span class="o">/</span><span class="n">common</span><span class="o">.</span><span class="n">Config</span> <span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">pb</span>
</pre></div>
</div>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">binary</span> <span class="nd">@updated_config</span><span class="o">.</span><span class="n">json</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">7059</span><span class="o">/</span><span class="n">protolator</span><span class="o">/</span><span class="n">encode</span><span class="o">/</span><span class="n">common</span><span class="o">.</span><span class="n">Config</span> <span class="o">&gt;</span> <span class="n">updated_config</span><span class="o">.</span><span class="n">pb</span>
</pre></div>
</div>
<p>Now, with both configs properly encoded, send them to the <cite>configtxlator</cite>
service to compute the config update which transitions between the two.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">F</span> <span class="n">original</span><span class="o">=</span><span class="nd">@config</span><span class="o">.</span><span class="n">pb</span> <span class="o">-</span><span class="n">F</span> <span class="n">updated</span><span class="o">=</span><span class="nd">@updated_config</span><span class="o">.</span><span class="n">pb</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">7059</span><span class="o">/</span><span class="n">configtxlator</span><span class="o">/</span><span class="n">compute</span><span class="o">/</span><span class="n">update</span><span class="o">-</span><span class="n">from</span><span class="o">-</span><span class="n">configs</span> <span class="o">-</span><span class="n">F</span> <span class="n">channel</span><span class="o">=</span><span class="n">testchainid</span> <span class="o">&gt;</span> <span class="n">config_update</span><span class="o">.</span><span class="n">pb</span>
</pre></div>
</div>
<p>At this point, the computed config update is now prepared. Traditionally,
an SDK would be used to sign and wrap this message. However, in the interest of
using only the peer cli, the <cite>configtxlator</cite> can also be used for this task.</p>
<p>First, we decode the ConfigUpdate so that we may work with it as text:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -X POST --data-binary @config_update.pb http://127.0.0.1:7059/protolator/decode/common.ConfigUpdate &gt; config_update.json
</pre></div>
</div>
<p>Then, we wrap it in an envelope message:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>echo &#39;{&quot;payload&quot;:{&quot;header&quot;:{&quot;channel_header&quot;:{&quot;channel_id&quot;:&quot;testchainid&quot;, &quot;type&quot;:2}},&quot;data&quot;:{&quot;config_update&quot;:&#39;$(cat config_update.json)&#39;}}}&#39; &gt; config_update_as_envelope.json
</pre></div>
</div>
<p>Next, convert it back into the proto form of a full fledged config
transaction:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">binary</span> <span class="nd">@config_update_as_envelope</span><span class="o">.</span><span class="n">json</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">7059</span><span class="o">/</span><span class="n">protolator</span><span class="o">/</span><span class="n">encode</span><span class="o">/</span><span class="n">common</span><span class="o">.</span><span class="n">Envelope</span> <span class="o">&gt;</span> <span class="n">config_update_as_envelope</span><span class="o">.</span><span class="n">pb</span>
</pre></div>
</div>
<p>Finally, submit the config update transaction to ordering to perform a config
update.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peer</span> <span class="n">channel</span> <span class="n">update</span> <span class="o">-</span><span class="n">f</span> <span class="n">config_update_as_envelope</span><span class="o">.</span><span class="n">pb</span> <span class="o">-</span><span class="n">c</span> <span class="n">testchainid</span> <span class="o">-</span><span class="n">o</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">7050</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-an-organization">
<h2>Adding an organization<a class="headerlink" href="#adding-an-organization" title="Permalink to this headline">¶</a></h2>
<p>First start the <code class="docutils literal notranslate"><span class="pre">configtxlator</span></code>:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>$ configtxlator start
2017-05-31 12:57:22.499 EDT [configtxlator] main -&gt; INFO 001 Serving HTTP requests on port: 7059
</pre></div>
</div>
<p>Start the orderer using the <code class="docutils literal notranslate"><span class="pre">SampleDevModeSolo</span></code> profile option.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ORDERER_GENERAL_LOGLEVEL</span><span class="o">=</span><span class="n">debug</span> <span class="n">ORDERER_GENERAL_GENESISPROFILE</span><span class="o">=</span><span class="n">SampleDevModeSolo</span> <span class="n">orderer</span>
</pre></div>
</div>
<p>The process to add an organization then follows exactly like the batch size
example. However, instead of setting the batch size, a new org is defined at
the application level. Adding an organization is slightly more involved because
we must first create a channel, then modify its membership set.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="endorsement-policies.html" class="btn btn-neutral float-right" title="Endorsement policies" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="configtxgen.html" class="btn btn-neutral" title="Channel Configuration (configtxgen)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2017.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'master',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>